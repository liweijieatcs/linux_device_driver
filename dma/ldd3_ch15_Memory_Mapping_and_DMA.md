# ldd3 ch15 内存映射和DMA
主要讲3个方面<br>
- mmap的系统调用：将设备的内存映射到用户空间。这个可以提高性能
- 使用get_user_pages将用户空间映射到内核
- DMAIO直接内存访问
了解这些的前提是要知道内存子系统是如何工作的。<br>
## linux的内存管理
### 地址的类型
有了虚拟内存，程序对物理地址就不可见了，相当于一个中间层。
- 用户虚拟地址：就是用户空间程序看到的地址，没有程序都有自己的虚拟地址空间
- 物理地址：处理器和物理内存之间使用的地址
- 总线地址：外设总线和内存之间使用的地址，可以通过IOMMU在总线和内存之间进行映射
- 内核逻辑地址：内核的地址空间，这些地址映射了主存的某些地址，通常被当成物理地址对待，通过kmalloc返回，用unsigned long 或者void *表示
- 内核虚拟地址：类似逻辑地址，也是将内核映射到物理地址。比如vmalloc, kmap返回的地址，通常用指针表示。

物理地址转化为虚拟地址__va(),虚拟地址转化为物理地址__pa()

### 物理地址和页面
物理内存的基本单位是page，一个page有多大，是依据PAGE_SIZE<asm/page.h>这个宏来定义的，通常是4K(4096,12位)，就是内存地址的低12位用于page内的偏移。其他的用于表示是哪个page(PFN page frame number)。用PAGE_SHIFT来表示这个偏移<br>

### high memory and low memory高端内存和低端内存
对于32位的系统，我的虚拟地址范围可以达到4G，但是我的物理地址只有2G，怎么办？32位系统把内存访问限制在4G范围内。<br>
内核将4G的地址空间分成内核空间和用户空间。